**Project: ODIN Web Drop-in Component - MVP Implementation**

**1. Overview & Goal**

The primary goal is to create the foundational codebase and initial functionality for a reusable, framework-agnostic JavaScript "Drop-in" UI component library for ODIN Payments. This component will allow Exerp's customers to securely capture payment details within their own web applications, similar in concept to Adyen's Web Drop-in.

This MVP focuses _exclusively_ on:

- Setting up the recommended project structure and tooling (monorepo).
- Implementing the core drop-in component using the chosen technology stack.
- Integrating ODIN's `OdinPay.js` library for **one-time Credit Card payment detail capture only**.
- Establishing clear communication (input configuration and output callbacks) between the drop-in and its host application.
- Creating a local development and testing workflow.

**Future features** (ACH, payment agreement management, $0 auth, etc.) are **out of scope** for this initial task but the architecture should facilitate their later addition.

**2. Core Technology & Tooling Stack**

The project **must** use the following technology stack:

- **Component Compiler:** **Stencil.js** - To build standard Web Components from TypeScript/JSX.
- **Language:** **TypeScript** - For all component logic and API definitions.
- **Build Tool (Library Bundling):** **Vite** (in Library Mode) - To generate the final distributable bundles (ESM, UMD, CJS).
- **Monorepo Manager:** **Turborepo** - For managing the workspace, build caching, and task orchestration.
- **Package Manager:** **pnpm** - For dependency management and leveraging workspaces with Turborepo.

**3. Project Setup & Boilerplate Requirements**

The developer must perform the following setup tasks:

- **Initialize Monorepo:** Set up a new monorepo using Turborepo and pnpm workspaces.
  - Follow Turborepo documentation for initialization (`npx create-turbo@latest`).
  - Ensure pnpm is configured as the package manager.
- **Create Core Package:** Inside the monorepo's `packages/` directory, create the primary package for the Stencil components (e.g., `packages/core`).
  - Use the Stencil CLI (`npm init stencil`) to initialize this package, selecting the "component" starter template.
  - Configure `stencil.config.ts` for library output, targeting Web Components. Disable Shadow DOM initially (`shadow: false` for components needing external styling, though plan for potential future use or hybrid approaches).
- **Create Facade Package:** Inside `packages/`, create the main publishable package (e.g., `packages/odin-dropin`).
  - This package will act as the public API facade. Its `src/index.ts` will import necessary elements from `@odin-payments/core` (or your chosen name) and expose the public `OdinDropin` class/functions.
  - Initialize `package.json` and `tsconfig.json`.
- **Configure Build:** Set up Vite within the `packages/odin-dropin` package to bundle the facade and necessary Stencil runtime/loaders into ESM, UMD (`OdinDropin` global name), and CJS formats. Ensure Vite correctly handles dependencies on `@odin-payments/core`.
  - Configure Vite to generate TypeScript declaration files (`.d.ts`) using `vite-plugin-dts`.
  - Ensure CSS generated by Stencil is handled appropriately (e.g., extracted to a separate `style.css` file, configurable via Vite).
- **Configure Root:** Set up the root `package.json`, `turbo.json`, and `tsconfig.base.json` for the monorepo, defining workspaces and base build/dev scripts managed by Turborepo.

**4. ODIN Drop-in Component Implementation (MVP - One-Time CC Payment)**

Implement the initial ODIN Drop-in functionality within the `@odin-payments/core` Stencil package and expose it via the `@odin-payments/odin-dropin` facade package.

- **Public API (`@odin-payments/odin-dropin`):**
  - Expose a primary class or function set (e.g., `OdinDropin`) for initialization and mounting.
  - **Initialization:** Must accept a configuration object with at least:
    - `odinPublicToken` (string): The short-lived public token obtained from the ODIN backend (the _host application_ will fetch this and pass it in).
    - `config` (object, optional): Placeholder for future configuration like amount, currency, theme overrides etc.
  - **Mounting:** Provide a `mount(selector: string)` method that targets a DOM element (specified by CSS selector) where the drop-in UI will be rendered.
  - **Callbacks:** The configuration object must accept _at least_ the following callback functions provided by the host application:
    - `onSubmit(result: { paymentMethodId: string, /* other relevant state? */ })`: Called _only_ when `OdinPay.js` successfully returns a `paymentMethod` after the user submits the form. The drop-in **must** pass the extracted `paymentMethod.id` (and potentially other non-sensitive state if needed) to this callback. **Crucially, the drop-in itself does NOT perform the final payment API call.**
    - `onError(error: any)`: Called when `OdinPay.js` or the drop-in itself encounters an error during setup or user interaction (e.g., invalid input detected by OdinPay.js).
- **Internal Logic (`@odin-payments/core`):**
  - The core Stencil component(s) must:
    - Receive the `odinPublicToken` and other configuration via props from the facade.
    - Import and instantiate the official `OdinPay` library using the provided `odinPublicToken`. Basic theming options from the CodePen examples should be supported via the `config` passed to `OdinPay`.
    - Use `OdinPay.createCardForm()` to render the necessary payment fields.
    - **MVP Field Scope:** For this MVP, only implement the mandatory fields required for a basic one-time CC payment capture using `OdinPay.js`. Based on CodePen examples, this likely includes:
      - `cardInformation`: (Card Number, Expiry, CVC) - Rendered within a container.
      - `postalCode`: (Postal Code input) - Rendered within a container.
      - _(Optional but Recommended)_: Consider adding `name` field capture as it's often required.
    - **Secure Field Rendering:** Design the component structure to support rendering sensitive fields (Card Number, CVC, Expiry) within secure iframes, mirroring the Adyen/standard payment security pattern. While the _initial_ implementation might use standard inputs for simplicity during boilerplate setup, the component architecture **must** be designed to easily switch to using iframes for these fields in a subsequent step (this might involve creating separate minimal Stencil components or JS logic loaded into the iframes).
    - Configure the `submitButton.callback` within `OdinPay.createCardForm()`. On success, extract the `paymentMethod.id` from the `result` provided by `OdinPay.js` and trigger the host's `onSubmit` callback. On error within `OdinPay.js`, trigger the host's `onError` callback.
- **UI Rendering:**
  - Use Stencil's JSX/TSX to render the necessary container `div` elements that `OdinPay.js` targets for injecting its fields.
  - Provide basic, minimal default styling. Ensure class names are used to allow host applications to override styles easily (since Shadow DOM is initially disabled). Plan for CSS Custom Property usage for theming later.

**5. Testing & Development Workflow**

- **Local Demo:** Create a simple HTML/JS demo application within the monorepo (e.g., `apps/demo`).
  - This demo app must consume the `@odin-payments/odin-dropin` package locally using pnpm workspaces.
  - Include a script (e.g., `pnpm dev` within `apps/demo`) to serve this demo page locally using Vite or a similar simple server.
  - The demo page must provide:
    - An input field to paste a test `odinPublicToken`.
    - A button to initialize and mount the ODIN Drop-in component into a designated `div`.
    - Implement simple `onSubmit` and `onError` callbacks that log the received data/error to the browser console.
  - This setup allows the developer to visually test the drop-in component and its basic host communication during development.

**6. Initial Documentation**

- Create a `README.md` file in the root of the monorepo.
- Create a `README.md` file within the `packages/odin-dropin` package.
- This initial documentation must cover:
  - Project overview and purpose (MVP scope).
  - Instructions on how to install dependencies (`pnpm install`).
  - Instructions on how to build the library (`pnpm turbo build`).
  - Instructions on how to run the local demo application (`pnpm dev --filter=demo`).
  - A basic usage example showing how to import, configure (with callbacks), and mount the drop-in in plain JavaScript.

**7. Deliverables**

- A functional monorepo project structure managed by Turborepo and pnpm.
- A Stencil.js component package (`@odin-payments/core` or similar) implementing the basic CC capture UI wrapping `OdinPay.js`.
- A facade package (`@odin-payments/odin-dropin`) exposing the public API.
- Vite build configuration generating ESM, UMD, and CJS bundles for the facade package, including `.d.ts` files.
- A working local demo application (`apps/demo`) for testing the drop-in.
- Initial `README.md` files as specified.
- The codebase must be written in TypeScript and adhere to standard linting practices (configure ESLint/Prettier).

---
